<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liberty Lab - USCIS Civics Test Study Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            background-color: var(--gray-900);
            color: var(--gray-100);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.light-mode {
            background-color: var(--gray-50);
            color: var(--gray-900);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-700);
        }

        body.light-mode header {
            border-bottom-color: var(--gray-200);
        }

        .app-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--gray-400);
            max-width: 600px;
            margin: 0 auto;
        }

        body.light-mode .subtitle {
            color: var(--gray-600);
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--gray-700);
            border: 1px solid var(--gray-600);
            color: var(--gray-100);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
            font-size: 14px;
        }

        body.light-mode .control-btn {
            background: var(--gray-200);
            border-color: var(--gray-300);
            color: var(--gray-800);
        }

        .control-btn:hover {
            background: var(--gray-600);
        }

        body.light-mode .control-btn:hover {
            background: var(--gray-300);
        }

        .font-controls {
            display: flex;
            gap: 5px;
        }

        .font-controls .control-btn {
            padding: 8px 12px;
            min-width: 40px;
        }

        .app-content {
            background: var(--gray-800);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
        }

        body.light-mode .app-content {
            background: white;
            box-shadow: var(--shadow);
        }

        .menu-grid {
            display: grid;
            gap: 20px;
        }

        .category-card {
            background: var(--gray-700);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        body.light-mode .category-card {
            background: var(--gray-100);
        }

        .category-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .subcategory-list {
            display: grid;
            gap: 10px;
        }

        .subcategory-btn {
            background: var(--gray-600);
            border: none;
            color: var(--gray-100);
            padding: 15px;
            border-radius: 6px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid var(--warning);
        }

        body.light-mode .subcategory-btn {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .subcategory-btn:hover {
            background: var(--gray-500);
            transform: translateY(-2px);
        }

        body.light-mode .subcategory-btn:hover {
            background: var(--gray-300);
        }

        .special-category {
            background: var(--gray-700);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        body.light-mode .special-category {
            background: var(--gray-100);
        }

        .special-btn {
            background: var(--primary);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 6px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
        }

        .special-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .mode-select-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .mode-btn {
            background: var(--gray-700);
            border: none;
            color: var(--gray-100);
            padding: 20px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 15px;
            width: 100%;
        }

        body.light-mode .mode-btn {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .mode-btn:hover {
            background: var(--gray-600);
            transform: translateY(-2px);
        }

        body.light-mode .mode-btn:hover {
            background: var(--gray-300);
        }

        .mode-btn.study {
            background: var(--primary);
            color: white;
        }

        .mode-btn.study:hover {
            background: var(--primary-dark);
        }

        .mode-btn.practice {
            background: var(--success);
            color: white;
        }

        .mode-btn.practice:hover {
            background: #0da271;
        }

        .question-container {
            margin-bottom: 25px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.4rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .answer-container {
            background: var(--success);
            border: 1px solid #0da271;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        body.light-mode .answer-container {
            background: #d1fae5;
            border-color: #a7f3d0;
        }

        .answer-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
        }

        body.light-mode .answer-title {
            color: var(--gray-800);
        }

        .answer-list {
            list-style-type: none;
        }

        .answer-item {
            color: white;
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
        }

        body.light-mode .answer-item {
            color: var(--gray-800);
        }

        .answer-bullet {
            color: white;
            margin-right: 10px;
        }

        body.light-mode .answer-bullet {
            color: var(--gray-800);
        }

        .practice-input {
            width: 100%;
            background: var(--gray-700);
            border: 1px solid var(--gray-600);
            color: var(--gray-100);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
        }

        body.light-mode .practice-input {
            background: white;
            border-color: var(--gray-300);
            color: var(--gray-800);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--gray-700);
            color: var(--gray-100);
            border: 1px solid var(--gray-600);
        }

        body.light-mode .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
            border-color: var(--gray-300);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--gray-600);
        }

        body.light-mode .btn-secondary:hover:not(:disabled) {
            background: var(--gray-300);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
        }

        .results-container {
            text-align: center;
        }

        .score-display {
            font-size: 4rem;
            font-weight: 700;
            margin: 20px 0;
        }

        .score-pass {
            color: var(--success);
        }

        .score-fail {
            color: var(--error);
        }

        .result-message {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .answers-review {
            text-align: left;
            margin-top: 30px;
        }

        .answer-review-item {
            background: var(--gray-700);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        body.light-mode .answer-review-item {
            background: var(--gray-100);
        }

        .answer-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .status-correct {
            color: var(--success);
        }

        .status-incorrect {
            color: var(--error);
        }

        .hidden {
            display: none;
        }

        .asterisk-badge {
            background: var(--warning);
            color: black;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .app-content {
                padding: 20px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .control-panel {
                gap: 10px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .question-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <header>
            <div class="app-title">
                <span>🚩</span>
                <h1>LIBERTY LAB</h1>
                <span>🚩</span>
            </div>
            <p class="subtitle">2025 USCIS Civics Test Study Tool - 128 Official Questions</p>
            
            <div class="control-panel">
                <button id="voiceToggle" class="control-btn" title="Voice Input (Coming Soon)">
                    <span>🎤</span> Voice: Off
                </button>
                
                <button id="themeToggle" class="control-btn" title="Toggle Dark/Light Mode">
                    <span>🌙</span> Dark Mode
                </button>
                
                <div class="font-controls">
                    <button id="fontDecrease" class="control-btn" title="Decrease Font Size">A-</button>
                    <button id="fontReset" class="control-btn" title="Reset Font Size">A</button>
                    <button id="fontIncrease" class="control-btn" title="Increase Font Size">A+</button>
                </div>
            </div>
        </header>
        
        <main>
            <!-- Menu View -->
            <div id="menuView" class="app-content">
                <div class="menu-grid">
                    <div class="special-category">
                        <h2 class="category-title">Special Categories</h2>
                        <button id="allQuestionsBtn" class="special-btn">
                            <div class="font-semibold">All Questions Mixed</div>
                            <div class="text-sm">Study all 128 questions in random order</div>
                        </button>
                        <button id="asteriskQuestionsBtn" class="special-btn" style="background: var(--success);">
                            <div class="font-semibold">65/20 Special Questions ⭐</div>
                            <div class="text-sm">20 questions for 65+ residents with 20+ years LPR status</div>
                        </button>
                    </div>
                    
                    <!-- Categories will be dynamically generated -->
                    <div id="categoriesContainer"></div>
                </div>
            </div>
            
            <!-- Mode Select View -->
            <div id="modeSelectView" class="app-content hidden">
                <button id="backToMenuBtn" class="btn-secondary">
                    <span>←</span> Back to Menu
                </button>
                
                <div class="text-center mb-8">
                    <h1>Choose Study Mode</h1>
                    <p id="selectedCategoryText" class="subtitle"></p>
                </div>
                
                <div class="mode-select-container">
                    <button id="studyModeBtn" class="mode-btn study">
                        <div class="flex items-center gap-3 mb-2">
                            <span>📖</span>
                            <span class="text-xl font-bold">Study Mode</span>
                        </div>
                        <p>Read through questions and answers at your own pace</p>
                    </button>
                    
                    <button id="practiceModeBtn" class="mode-btn practice">
                        <div class="flex items-center gap-3 mb-2">
                            <span>🎯</span>
                            <span class="text-xl font-bold">Practice Mode</span>
                        </div>
                        <p>Test yourself with up to 20 random questions</p>
                    </button>
                </div>
            </div>
            
            <!-- Question View -->
            <div id="questionView" class="app-content hidden">
                <div class="question-header">
                    <button id="backToModeBtn" class="btn-secondary">
                        <span>←</span> Menu
                    </button>
                    
                    <div class="text-center">
                        <div id="questionProgress" class="text-sm">Question 1 of 10</div>
                        <div id="asteriskBadge" class="asterisk-badge hidden">⭐ 65/20 Special</div>
                    </div>
                    
                    <button id="resetBtn" class="btn-secondary">
                        <span>↻</span> Reset
                    </button>
                </div>
                
                <div class="question-container">
                    <h2 id="questionText" class="question-text">What is the form of government of the United States?</h2>
                    
                    <div id="studyModeContainer">
                        <div id="showAnswerContainer">
                            <button id="showAnswerBtn" class="btn-primary">
                                Show Answer
                            </button>
                        </div>
                        <div id="answerContainer" class="answer-container hidden">
                            <h3 class="answer-title">Acceptable Answers:</h3>
                            <ul id="answerList" class="answer-list">
                                <!-- Answers will be inserted here -->
                            </ul>
                        </div>
                    </div>
                    
                    <div id="practiceModeContainer" class="hidden">
                        <textarea id="practiceInput" class="practice-input" placeholder="Type your answer here..."></textarea>
                        <button id="submitAnswerBtn" class="btn-primary">
                            Submit Answer
                        </button>
                    </div>
                </div>
                
                <div id="studyNavigation" class="navigation">
                    <button id="prevQuestionBtn" class="btn-secondary" disabled>
                        <span>←</span> Previous
                    </button>
                    <button id="nextQuestionBtn" class="btn-secondary">
                        Next <span>→</span>
                    </button>
                </div>
            </div>
            
            <!-- Results View -->
            <div id="resultsView" class="app-content hidden">
                <div class="results-container">
                    <h1>Practice Complete!</h1>
                    <div id="scoreDisplay" class="score-display score-pass">16/20</div>
                    <div id="percentageDisplay" class="text-2xl mb-2">80%</div>
                    <div id="passFailDisplay" class="text-lg">✅ PASSED</div>
                    <p id="passingCriteria" class="text-gray-400 mt-2">Need 60% to pass (12/20)</p>
                </div>
                
                <div class="answers-review">
                    <h3>Review Your Answers</h3>
                    <div id="answersList">
                        <!-- Answers will be inserted here -->
                    </div>
                </div>
                
                <div class="navigation">
                    <button id="tryAgainBtn" class="btn-primary">
                        Try Again
                    </button>
                    <button id="backToMenuFromResultsBtn" class="btn-secondary">
                        Back to Menu
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // USCIS Civics Questions Data - EXACT 128 QUESTIONS FROM 2025 VERSION
        const civicsQuestions = {
            "American Government": {
                "Principles of American Government": [
                    {
                        question: "What is the form of government of the United States?",
                        answers: ["Republic", "Constitution-based federal republic", "Representative democracy"]
                    },
                    {
                        question: "What is the supreme law of the land?",
                        answers: ["(U.S.) Constitution"],
                        asterisk: true
                    },
                    {
                        question: "Name one thing the U.S. Constitution does.",
                        answers: ["Forms the government", "Defines powers of government", "Defines the parts of government", "Protects the rights of the people"]
                    },
                    {
                        question: "The U.S. Constitution starts with the words \"We the People.\" What does \"We the People\" mean?",
                        answers: ["Self-government", "Popular sovereignty", "Consent of the governed", "People should govern themselves", "(Example of) social contract"]
                    },
                    {
                        question: "How are changes made to the U.S. Constitution?",
                        answers: ["Amendments", "The amendment process"]
                    },
                    {
                        question: "What does the Bill of Rights protect?",
                        answers: ["(The basic) rights of Americans", "(The basic) rights of people living in the United States"]
                    },
                    {
                        question: "How many amendments does the U.S. Constitution have?",
                        answers: ["Twenty-seven (27)"],
                        asterisk: true
                    },
                    {
                        question: "Why is the Declaration of Independence important?",
                        answers: ["It says America is free from British control.", "It says all people are created equal.", "It identifies inherent rights.", "It identifies individual freedoms."]
                    },
                    {
                        question: "What founding document said the American colonies were free from Britain?",
                        answers: ["Declaration of Independence"]
                    },
                    {
                        question: "Name two important ideas from the Declaration of Independence and the U.S. Constitution.",
                        answers: ["Equality", "Liberty", "Social contract", "Natural rights", "Limited government", "Self-government"]
                    },
                    {
                        question: "The words \"Life, Liberty, and the pursuit of Happiness\" are in what founding document?",
                        answers: ["Declaration of Independence"]
                    },
                    {
                        question: "What is the economic system of the United States?",
                        answers: ["Capitalism", "Free market economy"],
                        asterisk: true
                    },
                    {
                        question: "What is the rule of law?",
                        answers: ["Everyone must follow the law.", "Leaders must obey the law.", "Government must obey the law.", "No one is above the law."]
                    },
                    {
                        question: "Many documents influenced the U.S. Constitution. Name one.",
                        answers: ["Declaration of Independence", "Articles of Confederation", "Federalist Papers", "Anti-Federalist Papers", "Virginia Declaration of Rights", "Fundamental Orders of Connecticut", "Mayflower Compact", "Iroquois Great Law of Peace"]
                    },
                    {
                        question: "There are three branches of government. Why?",
                        answers: ["So one part does not become too powerful", "Checks and balances", "Separation of powers"]
                    }
                ],
                "System of Government": [
                    {
                        question: "Name the three branches of government.",
                        answers: ["Legislative, executive, and judicial", "Congress, president, and the courts"]
                    },
                    {
                        question: "The President of the United States is in charge of which branch of government?",
                        answers: ["Executive branch"]
                    },
                    {
                        question: "What part of the federal government writes laws?",
                        answers: ["(U.S.) Congress", "(U.S. or national) legislature", "Legislative branch"]
                    },
                    {
                        question: "What are the two parts of the U.S. Congress?",
                        answers: ["Senate and House (of Representatives)"]
                    },
                    {
                        question: "Name one power of the U.S. Congress.",
                        answers: ["Writes laws", "Declares war", "Makes the federal budget"],
                        asterisk: true
                    },
                    {
                        question: "How many U.S. senators are there?",
                        answers: ["One hundred (100)"]
                    },
                    {
                        question: "How long is a term for a U.S. senator?",
                        answers: ["Six (6) years"]
                    },
                    {
                        question: "Who is one of your state's U.S. senators now?",
                        answers: ["Answers will vary. [District of Columbia residents and residents of U.S. territories should answer that D.C. (or the territory where the applicant lives) has no U.S. senators.]"]
                    },
                    {
                        question: "How many voting members are in the House of Representatives?",
                        answers: ["Four hundred thirty-five (435)"]
                    },
                    {
                        question: "How long is a term for a member of the House of Representatives?",
                        answers: ["Two (2) years"]
                    },
                    {
                        question: "Why do U.S. representatives serve shorter terms than U.S. senators?",
                        answers: ["To more closely follow public opinion"]
                    },
                    {
                        question: "How many senators does each state have?",
                        answers: ["Two (2)"]
                    },
                    {
                        question: "Why does each state have two senators?",
                        answers: ["Equal representation (for small states)", "The Great Compromise (Connecticut Compromise)"]
                    },
                    {
                        question: "Name your U.S. representative.",
                        answers: ["Answers will vary. [Residents of territories with nonvoting Delegates or Resident Commissioners may provide the name of that Delegate or Commissioner. Also acceptable is any statement that the territory has no (voting) representatives in Congress.]"]
                    },
                    {
                        question: "What is the name of the Speaker of the House of Representatives now?",
                        answers: ["Visit uscis.gov/citizenship/testupdates for the name of the Speaker of the House of Representatives."],
                        asterisk: true
                    },
                    {
                        question: "Who does a U.S. senator represent?",
                        answers: ["Citizens of their state", "People of their state"]
                    },
                    {
                        question: "Who elects U.S. senators?",
                        answers: ["Citizens from their state"]
                    },
                    {
                        question: "Who does a member of the House of Representatives represent?",
                        answers: ["Citizens in their (congressional) district", "Citizens in their district", "People from their (congressional) district", "People in their district"]
                    },
                    {
                        question: "Who elects members of the House of Representatives?",
                        answers: ["Citizens from their (congressional) district"]
                    },
                    {
                        question: "Some states have more representatives than other states. Why?",
                        answers: ["(Because of) the state's population", "(Because) they have more people", "(Because) some states have more people"]
                    },
                    {
                        question: "The President of the United States is elected for how many years?",
                        answers: ["Four (4) years"],
                        asterisk: true
                    },
                    {
                        question: "The President of the United States can serve only two terms. Why?",
                        answers: ["(Because of) the 22nd Amendment", "To keep the president from becoming too powerful"]
                    },
                    {
                        question: "What is the name of the President of the United States now?",
                        answers: ["Visit uscis.gov/citizenship/testupdates for the name of the President of the United States."],
                        asterisk: true
                    },
                    {
                        question: "What is the name of the Vice President of the United States now?",
                        answers: ["Visit uscis.gov/citizenship/testupdates for the name of the Vice President of the United States."],
                        asterisk: true
                    },
                    {
                        question: "If the president can no longer serve, who becomes president?",
                        answers: ["The Vice President (of the United States)"]
                    },
                    {
                        question: "Name one power of the president.",
                        answers: ["Signs bills into law", "Vetoes bills", "Enforces laws", "Commander in Chief (of the military)", "Chief diplomat", "Appoints federal judges"]
                    },
                    {
                        question: "Who is Commander in Chief of the U.S. military?",
                        answers: ["The President (of the United States)"]
                    },
                    {
                        question: "Who signs bills to become laws?",
                        answers: ["The President (of the United States)"]
                    },
                    {
                        question: "Who vetoes bills?",
                        answers: ["The President (of the United States)"],
                        asterisk: true
                    },
                    {
                        question: "Who appoints federal judges?",
                        answers: ["The President (of the United States)"]
                    },
                    {
                        question: "The executive branch has many parts. Name one.",
                        answers: ["President (of the United States)", "Cabinet", "Federal departments and agencies"]
                    },
                    {
                        question: "What does the President's Cabinet do?",
                        answers: ["Advises the President (of the United States)"]
                    },
                    {
                        question: "What are two Cabinet-level positions?",
                        answers: ["Attorney General", "Secretary of Agriculture", "Secretary of Commerce", "Secretary of Education", "Secretary of Energy", "Secretary of Health and Human Services", "Secretary of Homeland Security", "Secretary of Housing and Urban Development", "Secretary of the Interior", "Secretary of Labor", "Secretary of State", "Secretary of Transportation", "Secretary of the Treasury", "Secretary of Veterans Affairs", "Secretary of War (Defense)", "Vice-President", "Administrator of the Environmental Protection Agency", "Administrator of the Small Business Administration", "Director of the Central Intelligence Agency", "Director of the Office of Management and Budget", "Director of National Intelligence", "United States Trade Representative"]
                    },
                    {
                        question: "Why is the Electoral College important?",
                        answers: ["It decides who is elected president.", "It provides a compromise between the popular election of the president and congressional selection."]
                    },
                    {
                        question: "What is one part of the judicial branch?",
                        answers: ["Supreme Court", "Federal Courts"]
                    },
                    {
                        question: "What does the judicial branch do?",
                        answers: ["Reviews laws", "Explains laws", "Resolves disputes (disagreements) about the law", "Decides if a law goes against the (U.S.) Constitution"]
                    },
                    {
                        question: "What is the highest court in the United States?",
                        answers: ["Supreme Court"],
                        asterisk: true
                    },
                    {
                        question: "How many seats are on the Supreme Court?",
                        answers: ["Nine (9)"]
                    },
                    {
                        question: "How many Supreme Court justices are usually needed to decide a case?",
                        answers: ["Five (5)"]
                    },
                    {
                        question: "How long do Supreme Court justices serve?",
                        answers: ["(For) life", "Lifetime appointment", "(Until) retirement"]
                    },
                    {
                        question: "Supreme Court justices serve for life. Why?",
                        answers: ["To be independent (of politics)", "To limit outside (political) influence"]
                    },
                    {
                        question: "Who is the Chief Justice of the United States now?",
                        answers: ["Visit uscis.gov/citizenship/testupdates for the name of the Chief Justice of the United States."]
                    },
                    {
                        question: "Name one power that is only for the federal government.",
                        answers: ["Print paper money", "Mint coins", "Declare war", "Create an army", "Make treaties", "Set foreign policy"]
                    },
                    {
                        question: "Name one power that is only for the states.",
                        answers: ["Provide schooling and education", "Provide protection (police)", "Provide safety (fire departments)", "Give a driver's license", "Approve zoning and land use"]
                    },
                    {
                        question: "What is the purpose of the 10th Amendment?",
                        answers: ["(It states that the) powers not given to the federal government belong to the states or to the people."]
                    },
                    {
                        question: "Who is the governor of your state now?",
                        answers: ["Answers will vary. [District of Columbia residents should answer that D.C. does not have a governor.]"],
                        asterisk: true
                    },
                    {
                        question: "What is the capital of your state?",
                        answers: ["Answers will vary. [District of Columbia residents should answer that D.C. is not a state and does not have a capital. Residents of U.S. territories should name the capital of the territory.]"]
                    }
                ],
                "Rights and Responsibilities": [
                    {
                        question: "There are four amendments to the U.S. Constitution about who can vote. Describe one of them.",
                        answers: ["Citizens eighteen (18) and older (can vote).", "You don't have to pay (a poll tax) to vote.", "Any citizen can vote. (Women and men can vote.)", "A male citizen of any race (can vote)."]
                    },
                    {
                        question: "Who can vote in federal elections, run for federal office, and serve on a jury in the United States?",
                        answers: ["Citizens", "Citizens of the United States", "U.S. citizens"]
                    },
                    {
                        question: "What are three rights of everyone living in the United States?",
                        answers: ["Freedom of expression", "Freedom of speech", "Freedom of assembly", "Freedom to petition the government", "Freedom of religion", "The right to bear arms"]
                    },
                    {
                        question: "What do we show loyalty to when we say the Pledge of Allegiance?",
                        answers: ["The United States", "The flag"],
                        asterisk: true
                    },
                    {
                        question: "Name two promises that new citizens make in the Oath of Allegiance.",
                        answers: ["Give up loyalty to other countries", "Defend the (U.S.) Constitution", "Obey the laws of the United States", "Serve in the military (if needed)", "Serve (help, do important work for) the nation (if needed)", "Be loyal to the United States"]
                    },
                    {
                        question: "How can people become United States citizens?",
                        answers: ["Be born in the United States, under the conditions set by the 14th Amendment", "Naturalize", "Derive citizenship (under conditions set by Congress)"]
                    },
                    {
                        question: "What are two examples of civic participation in the United States?",
                        answers: ["Vote", "Run for office", "Join a political party", "Help with a campaign", "Join a civic group", "Join a community group", "Give an elected official your opinion (on an issue)", "Contact elected officials", "Support or oppose an issue or policy", "Write to a newspaper"]
                    },
                    {
                        question: "What is one way Americans can serve their country?",
                        answers: ["Vote", "Pay taxes", "Obey the law", "Serve in the military", "Run for office", "Work for local, state, or federal government"]
                    },
                    {
                        question: "Why is it important to pay federal taxes?",
                        answers: ["Required by law", "All people pay to fund the federal government", "Required by the (U.S.) Constitution (16th Amendment)", "Civic duty"]
                    },
                    {
                        question: "It is important for all men age 18 through 25 to register for the Selective Service. Name one reason why.",
                        answers: ["Required by law", "Civic duty", "Makes the draft fair, if needed"]
                    }
                ]
            },
            "American History": {
                "Colonial Period and Independence": [
                    {
                        question: "The colonists came to America for many reasons. Name one.",
                        answers: ["Freedom", "Political liberty", "Religious freedom", "Economic opportunity", "Escape persecution"]
                    },
                    {
                        question: "Who lived in America before the Europeans arrived?",
                        answers: ["American Indians", "Native Americans"],
                        asterisk: true
                    },
                    {
                        question: "What group of people was taken and sold as slaves?",
                        answers: ["Africans", "People from Africa"]
                    },
                    {
                        question: "What war did the Americans fight to win independence from Britain?",
                        answers: ["American Revolution", "The (American) Revolutionary War", "War for (American) Independence"]
                    },
                    {
                        question: "Name one reason why the Americans declared independence from Britain.",
                        answers: ["High taxes", "Taxation without representation", "British soldiers stayed in Americans' houses (boarding, quartering)", "They did not have self-government", "Boston Massacre", "Boston Tea Party (Tea Act)", "Stamp Act", "Sugar Act", "Townshend Acts", "Intolerable (Coercive) Acts"]
                    },
                    {
                        question: "Who wrote the Declaration of Independence?",
                        answers: ["(Thomas) Jefferson"],
                        asterisk: true
                    },
                    {
                        question: "When was the Declaration of Independence adopted?",
                        answers: ["July 4, 1776"]
                    },
                    {
                        question: "The American Revolution had many important events. Name one.",
                        answers: ["(Battle of) Bunker Hill", "Declaration of Independence", "Washington Crossing the Delaware (Battle of Trenton)", "(Battle of) Saratoga", "Valley Forge (Encampment)", "(Battle of) Yorktown (British surrender at Yorktown)"]
                    },
                    {
                        question: "There were 13 original states. Name five.",
                        answers: ["New Hampshire", "Massachusetts", "Rhode Island", "Connecticut", "New York", "New Jersey", "Pennsylvania", "Delaware", "Maryland", "Virginia", "North Carolina", "South Carolina", "Georgia"]
                    },
                    {
                        question: "What founding document was written in 1787?",
                        answers: ["(U.S.) Constitution"]
                    },
                    {
                        question: "The Federalist Papers supported the passage of the U.S. Constitution. Name one of the writers.",
                        answers: ["(James) Madison", "(Alexander) Hamilton", "(John) Jay", "Publius"]
                    },
                    {
                        question: "Why were the Federalist Papers important?",
                        answers: ["They helped people understand the (U.S.) Constitution.", "They supported passing the (U.S.) Constitution."]
                    },
                    {
                        question: "Benjamin Franklin is famous for many things. Name one.",
                        answers: ["Founded the first free public libraries", "First Postmaster General of the United States", "Helped write the Declaration of Independence", "Inventor", "U.S. diplomat"]
                    },
                    {
                        question: "George Washington is famous for many things. Name one.",
                        answers: ["\"Father of Our Country\"", "First president of the United States", "General of the Continental Army", "President of the Constitutional Convention"],
                        asterisk: true
                    },
                    {
                        question: "Thomas Jefferson is famous for many things. Name one.",
                        answers: ["Writer of the Declaration of Independence", "Third president of the United States", "Doubled the size of the United States (Louisiana Purchase)", "First Secretary of State", "Founded the University of Virginia", "Writer of the Virginia Statute on Religious Freedom"]
                    },
                    {
                        question: "James Madison is famous for many things. Name one.",
                        answers: ["\"Father of the Constitution\"", "Fourth president of the United States", "President during the War of 1812", "One of the writers of the Federalist Papers"]
                    },
                    {
                        question: "Alexander Hamilton is famous for many things. Name one.",
                        answers: ["First Secretary of the Treasury", "One of the writers of the Federalist Papers", "Helped establish the First Bank of the United States", "Aide to General George Washington", "Member of the Continental Congress"]
                    }
                ],
                "1800s": [
                    {
                        question: "What territory did the United States buy from France in 1803?",
                        answers: ["Louisiana Territory", "Louisiana"]
                    },
                    {
                        question: "Name one war fought by the United States in the 1800s.",
                        answers: ["War of 1812", "Mexican-American War", "Civil War", "Spanish-American War"]
                    },
                    {
                        question: "Name the U.S. war between the North and the South.",
                        answers: ["The Civil War"]
                    },
                    {
                        question: "The Civil War had many important events. Name one.",
                        answers: ["(Battle of) Fort Sumter", "Emancipation Proclamation", "(Battle of) Vicksburg", "(Battle of) Gettysburg", "Sherman's March", "(Surrender at) Appomattox", "(Battle of) Antietam/Sharpsburg", "Lincoln was assassinated."]
                    },
                    {
                        question: "Abraham Lincoln is famous for many things. Name one.",
                        answers: ["Freed the slaves (Emancipation Proclamation)", "Saved (or preserved) the Union", "Led the United States during the Civil War", "16th president of the United States", "Delivered the Gettysburg Address"],
                        asterisk: true
                    },
                    {
                        question: "What did the Emancipation Proclamation do?",
                        answers: ["Freed the slaves", "Freed slaves in the Confederacy", "Freed slaves in the Confederate states", "Freed slaves in most Southern states"]
                    },
                    {
                        question: "What U.S. war ended slavery?",
                        answers: ["The Civil War"]
                    },
                    {
                        question: "What amendment says all persons born or naturalized in the United States, and subject to the jurisdiction thereof, are U.S. citizens?",
                        answers: ["14th Amendment"]
                    },
                    {
                        question: "When did all men get the right to vote?",
                        answers: ["After the Civil War", "During Reconstruction", "(With the) 15th Amendment", "1870"]
                    },
                    {
                        question: "Name one leader of the women's rights movement in the 1800s.",
                        answers: ["Susan B. Anthony", "Elizabeth Cady Stanton", "Sojourner Truth", "Harriet Tubman", "Lucretia Mott", "Lucy Stone"]
                    }
                ],
                "Recent American History and Other Important Historical Information": [
                    {
                        question: "Name one war fought by the United States in the 1900s.",
                        answers: ["World War I", "World War II", "Korean War", "Vietnam War", "(Persian) Gulf War"]
                    },
                    {
                        question: "Why did the United States enter World War I?",
                        answers: ["Because Germany attacked U.S. (civilian) ships", "To support the Allied Powers (England, France, Italy, and Russia)", "To oppose the Central Powers (Germany, Austria-Hungary, the Ottoman Empire, and Bulgaria)"]
                    },
                    {
                        question: "When did all women get the right to vote?",
                        answers: ["1920", "After World War I", "(With the) 19th Amendment"]
                    },
                    {
                        question: "What was the Great Depression?",
                        answers: ["Longest economic recession in modern history"]
                    },
                    {
                        question: "When did the Great Depression start?",
                        answers: ["The Great Crash (1929)", "Stock market crash of 1929"]
                    },
                    {
                        question: "Who was president during the Great Depression and World War II?",
                        answers: ["(Franklin) Roosevelt"]
                    },
                    {
                        question: "Why did the United States enter World War II?",
                        answers: ["(Bombing of) Pearl Harbor", "Japanese attacked Pearl Harbor", "To support the Allied Powers (England, France, and Russia)", "To oppose the Axis Powers (Germany, Italy, and Japan)"]
                    },
                    {
                        question: "Dwight Eisenhower is famous for many things. Name one.",
                        answers: ["General during World War II", "President at the end of (during) the Korean War", "34th president of the United States", "Signed the Federal-Aid Highway Act of 1956 (Created the Interstate System)"]
                    },
                    {
                        question: "Who was the United States' main rival during the Cold War?",
                        answers: ["Soviet Union", "USSR", "Russia"]
                    },
                    {
                        question: "During the Cold War, what was one main concern of the United States?",
                        answers: ["Communism", "Nuclear war"]
                    },
                    {
                        question: "Why did the United States enter the Korean War?",
                        answers: ["To stop the spread of communism"]
                    },
                    {
                        question: "Why did the United States enter the Vietnam War?",
                        answers: ["To stop the spread of communism"]
                    },
                    {
                        question: "What did the civil rights movement do?",
                        answers: ["Fought to end racial discrimination"]
                    },
                    {
                        question: "Martin Luther King, Jr. is famous for many things. Name one.",
                        answers: ["Fought for civil rights", "Worked for equality for all Americans", "Worked to ensure that people would \"not be judged by the color of their skin, but by the content of their character\""],
                        asterisk: true
                    },
                    {
                        question: "Why did the United States enter the Persian Gulf War?",
                        answers: ["To force the Iraqi military from Kuwait"]
                    },
                    {
                        question: "What major event happened on September 11, 2001 in the United States?",
                        answers: ["Terrorists attacked the United States", "Terrorists took over two planes and crashed them into the World Trade Center in New York City", "Terrorists took over a plane and crashed into the Pentagon in Arlington, Virginia", "Terrorists took over a plane originally aimed at Washington, D.C., and crashed in a field in Pennsylvania"],
                        asterisk: true
                    },
                    {
                        question: "Name one U.S. military conflict after the September 11, 2001 attacks.",
                        answers: ["(Global) War on Terror", "War in Afghanistan", "War in Iraq"]
                    },
                    {
                        question: "Name one American Indian tribe in the United States.",
                        answers: ["Apache", "Blackfeet", "Cayuga", "Cherokee", "Cheyenne", "Chippewa", "Choctaw", "Creek", "Crow", "Hopi", "Huron", "Inupiat", "Lakota", "Mohawk", "Mohegan", "Navajo", "Oneida", "Onondaga", "Pueblo", "Seminole", "Seneca", "Shawnee", "Sioux", "Teton", "Tuscarora"]
                    },
                    {
                        question: "Name one example of an American innovation.",
                        answers: ["Light bulb", "Automobile (cars, internal combustion engine)", "Skyscrapers", "Airplane", "Assembly line", "Landing on the moon", "Integrated circuit (IC)"]
                    }
                ]
            },
            "Symbols and Holidays": {
                "Symbols": [
                    {
                        question: "What is the capital of the United States?",
                        answers: ["Washington, D.C."]
                    },
                    {
                        question: "Where is the Statue of Liberty?",
                        answers: ["New York (Harbor)", "Liberty Island [Also acceptable are New Jersey, near New York City, and on the Hudson (River).]"]
                    },
                    {
                        question: "Why does the flag have 13 stripes?",
                        answers: ["(Because there were) 13 original colonies", "(Because the stripes) represent the original colonies"],
                        asterisk: true
                    },
                    {
                        question: "Why does the flag have 50 stars?",
                        answers: ["(Because there is) one star for each state", "(Because) each star represents a state", "(Because there are) 50 states"]
                    },
                    {
                        question: "What is the name of the national anthem?",
                        answers: ["The Star-Spangled Banner"]
                    },
                    {
                        question: "The Nation's first motto was \"E Pluribus Unum.\" What does that mean?",
                        answers: ["Out of many, one", "We all become one"]
                    }
                ],
                "Holidays": [
                    {
                        question: "What is Independence Day?",
                        answers: ["A holiday to celebrate U.S. independence (from Britain)", "The country's birthday"]
                    },
                    {
                        question: "Name three national U.S. holidays.",
                        answers: ["New Year's Day", "Martin Luther King, Jr. Day", "Presidents Day (Washington's Birthday)", "Memorial Day", "Juneteenth", "Independence Day", "Labor Day", "Columbus Day", "Veterans Day", "Thanksgiving Day", "Christmas Day"],
                        asterisk: true
                    },
                    {
                        question: "What is Memorial Day?",
                        answers: ["A holiday to honor soldiers who died in military service"]
                    },
                    {
                        question: "What is Veterans Day?",
                        answers: ["A holiday to honor people in the (U.S.) military", "A holiday to honor people who have served (in the U.S. military)"]
                    }
                ]
            }
        };

        // VERIFICATION: Count total questions
        function countQuestions() {
            let total = 0;
            for (const category in civicsQuestions) {
                for (const subcategory in civicsQuestions[category]) {
                    total += civicsQuestions[category][subcategory].length;
                }
            }
            console.log(`Total questions in database: ${total}`);
            return total;
        }

        // App State
        let currentView = 'menu';
        let selectedCategory = null;
        let selectedSubcategory = null;
        let currentQuestionIndex = 0;
        let showAnswer = false;
        let studyMode = 'study';
        let practiceQuestions = [];
        let userAnswers = [];
        let currentAnswer = '';
        let practiceComplete = false;

        // DOM Elements
        const menuView = document.getElementById('menuView');
        const modeSelectView = document.getElementById('modeSelectView');
        const questionView = document.getElementById('questionView');
        const resultsView = document.getElementById('resultsView');
        
        const categoriesContainer = document.getElementById('categoriesContainer');
        const selectedCategoryText = document.getElementById('selectedCategoryText');
        
        const allQuestionsBtn = document.getElementById('allQuestionsBtn');
        const asteriskQuestionsBtn = document.getElementById('asteriskQuestionsBtn');
        const backToMenuBtn = document.getElementById('backToMenuBtn');
        const studyModeBtn = document.getElementById('studyModeBtn');
        const practiceModeBtn = document.getElementById('practiceModeBtn');
        const backToModeBtn = document.getElementById('backToModeBtn');
        const resetBtn = document.getElementById('resetBtn');
        const showAnswerBtn = document.getElementById('showAnswerBtn');
        const answerContainer = document.getElementById('answerContainer');
        const answerList = document.getElementById('answerList');
        const practiceInput = document.getElementById('practiceInput');
        const submitAnswerBtn = document.getElementById('submitAnswerBtn');
        const prevQuestionBtn = document.getElementById('prevQuestionBtn');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const questionText = document.getElementById('questionText');
        const questionProgress = document.getElementById('questionProgress');
        const asteriskBadge = document.getElementById('asteriskBadge');
        const studyModeContainer = document.getElementById('studyModeContainer');
        const practiceModeContainer = document.getElementById('practiceModeContainer');
        const studyNavigation = document.getElementById('studyNavigation');
        const tryAgainBtn = document.getElementById('tryAgainBtn');
        const backToMenuFromResultsBtn = document.getElementById('backToMenuFromResultsBtn');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const percentageDisplay = document.getElementById('percentageDisplay');
        const passFailDisplay = document.getElementById('passFailDisplay');
        const passingCriteria = document.getElementById('passingCriteria');
        const answersList = document.getElementById('answersList');
        
        // Control Panel Elements
        const voiceToggle = document.getElementById('voiceToggle');
        const themeToggle = document.getElementById('themeToggle');
        const fontDecrease = document.getElementById('fontDecrease');
        const fontReset = document.getElementById('fontReset');
        const fontIncrease = document.getElementById('fontIncrease');

        // Settings
        let settings = {
            voiceEnabled: false,
            darkMode: true,
            fontSize: 1
        };

        // Initialize the app
        function initApp() {
            loadSettings();
            setupEventListeners();
            renderCategories();
            applySettings();
            
            // Verify question count
            const totalQuestions = countQuestions();
            if (totalQuestions === 128) {
                console.log("✅ SUCCESS: All 128 questions are loaded correctly");
            } else {
                console.warn(`⚠️ WARNING: Expected 128 questions but found ${totalQuestions}`);
            }
        }

        // Load settings from localStorage
        function loadSettings() {
            const savedSettings = localStorage.getItem('libertyLabSettings');
            if (savedSettings) {
                settings = { ...settings, ...JSON.parse(savedSettings) };
            }
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('libertyLabSettings', JSON.stringify(settings));
        }

        // Apply current settings to the UI
        function applySettings() {
            // Apply theme
            document.body.className = settings.darkMode ? 'dark-mode' : 'light-mode';
            themeToggle.innerHTML = settings.darkMode ? '<span>🌙</span> Dark Mode' : '<span>☀️</span> Light Mode';
            
            // Apply font size
            document.documentElement.style.fontSize = `${settings.fontSize * 100}%`;
        }

        // Set up event listeners
        function setupEventListeners() {
            // Control panel events
            voiceToggle.addEventListener('click', toggleVoice);
            themeToggle.addEventListener('click', toggleTheme);
            fontDecrease.addEventListener('click', () => adjustFontSize(-0.1));
            fontIncrease.addEventListener('click', () => adjustFontSize(0.1));
            fontReset.addEventListener('click', resetFontSize);
            
            // Navigation events
            allQuestionsBtn.addEventListener('click', () => selectCategory('mixed', 'all'));
            asteriskQuestionsBtn.addEventListener('click', () => selectCategory('asterisk', '65-20'));
            backToMenuBtn.addEventListener('click', resetToMenu);
            studyModeBtn.addEventListener('click', () => startStudyMode());
            practiceModeBtn.addEventListener('click', startPractice);
            backToModeBtn.addEventListener('click', backToModeSelect);
            resetBtn.addEventListener('click', resetQuestions);
            showAnswerBtn.addEventListener('click', toggleAnswer);
            submitAnswerBtn.addEventListener('click', handlePracticeAnswer);
            prevQuestionBtn.addEventListener('click', prevQuestion);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            tryAgainBtn.addEventListener('click', startPractice);
            backToMenuFromResultsBtn.addEventListener('click', resetToMenu);
        }

        // Control panel functions
        function toggleVoice() {
            settings.voiceEnabled = !settings.voiceEnabled;
            voiceToggle.innerHTML = settings.voiceEnabled ? '<span>🎤</span> Voice: On' : '<span>🎤</span> Voice: Off';
            
            if (settings.voiceEnabled) {
                alert('Voice features will be available in a future update!');
                settings.voiceEnabled = false;
                voiceToggle.innerHTML = '<span>🎤</span> Voice: Off';
            }
            
            saveSettings();
        }

        function toggleTheme() {
            settings.darkMode = !settings.darkMode;
            applySettings();
            saveSettings();
        }

        function adjustFontSize(change) {
            settings.fontSize = Math.max(0.8, Math.min(1.5, settings.fontSize + change));
            applySettings();
            saveSettings();
        }

        function resetFontSize() {
            settings.fontSize = 1;
            applySettings();
            saveSettings();
        }

        // Render categories to the menu
        function renderCategories() {
            let categoriesHTML = '';
            
            for (const [categoryName, subcategories] of Object.entries(civicsQuestions)) {
                let categoryHTML = `
                    <div class="category-card">
                        <h2 class="category-title">${categoryName}</h2>
                        <div class="subcategory-list">
                `;
                
                for (const [subcategoryName, questions] of Object.entries(subcategories)) {
                    categoryHTML += `
                        <button class="subcategory-btn" data-category="${categoryName}" data-subcategory="${subcategoryName}">
                            <div class="font-semibold">${subcategoryName}</div>
                            <div class="text-sm">${questions.length} questions</div>
                        </button>
                    `;
                }
                
                categoryHTML += `
                        </div>
                    </div>
                `;
                
                categoriesHTML += categoryHTML;
            }
            
            categoriesContainer.innerHTML = categoriesHTML;
            
            // Add event listeners to subcategory buttons
            document.querySelectorAll('.subcategory-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    const subcategory = this.getAttribute('data-subcategory');
                    selectCategory(category, subcategory);
                });
            });
        }

        // Select a category and go to mode select
        function selectCategory(category, subcategory) {
            selectedCategory = category;
            selectedSubcategory = subcategory;
            
            // Update the selected category text
            if (category === 'mixed') {
                selectedCategoryText.textContent = 'All Questions Mixed';
            } else if (category === 'asterisk') {
                selectedCategoryText.textContent = '65/20 Special Questions';
            } else {
                selectedCategoryText.textContent = `${category} - ${subcategory}`;
            }
            
            // Switch to mode select view
            showView('modeSelect');
        }

        // Start study mode
        function startStudyMode() {
            studyMode = 'study';
            currentQuestionIndex = 0;
            showAnswer = false;
            showView('question');
            loadQuestion();
        }

        // Start practice mode
        function startPractice() {
            const questions = getCurrentQuestions();
            const shuffled = [...questions].sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, Math.min(20, shuffled.length));
            practiceQuestions = selected;
            userAnswers = [];
            currentQuestionIndex = 0;
            currentAnswer = '';
            practiceComplete = false;
            studyMode = 'practice';
            showView('question');
            loadQuestion();
        }

        // Get current questions based on selection
        function getCurrentQuestions() {
            if (selectedCategory === 'mixed') {
                return getAllQuestions();
            }
            if (selectedCategory === 'asterisk') {
                return getAsteriskQuestions();
            }
            if (selectedSubcategory) {
                return civicsQuestions[selectedCategory][selectedSubcategory];
            }
            return [];
        }

        // Get all questions
        function getAllQuestions() {
            const allQuestions = [];
            Object.values(civicsQuestions).forEach(category => {
                Object.values(category).forEach(subcategory => {
                    allQuestions.push(...subcategory);
                });
            });
            return allQuestions;
        }

        // Get asterisk questions (65/20 special)
        function getAsteriskQuestions() {
            const allQuestions = getAllQuestions();
            return allQuestions.filter(q => q.asterisk);
        }

        // Load the current question
        function loadQuestion() {
            const questions = studyMode === 'practice' ? practiceQuestions : getCurrentQuestions();
            const currentQuestion = questions[currentQuestionIndex];
            
            if (!currentQuestion) {
                // No questions available
                resetToMenu();
                return;
            }
            
            // Update question text
            questionText.textContent = currentQuestion.question;
            
            // Update progress
            questionProgress.textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            
            // Show/hide asterisk badge
            if (currentQuestion.asterisk) {
                asteriskBadge.classList.remove('hidden');
            } else {
                asteriskBadge.classList.add('hidden');
            }
            
            // Show/hide study or practice mode UI
            if (studyMode === 'study') {
                studyModeContainer.classList.remove('hidden');
                practiceModeContainer.classList.add('hidden');
                studyNavigation.classList.remove('hidden');
                
                // Reset answer display
                answerContainer.classList.add('hidden');
                showAnswerBtn.textContent = 'Show Answer';
                showAnswer = false;
                
                // Update navigation buttons
                prevQuestionBtn.disabled = currentQuestionIndex === 0;
                nextQuestionBtn.disabled = currentQuestionIndex === questions.length - 1;
            } else {
                studyModeContainer.classList.add('hidden');
                practiceModeContainer.classList.remove('hidden');
                studyNavigation.classList.add('hidden');
                
                // Clear practice input
                practiceInput.value = '';
                currentAnswer = '';
            }
        }

        // Toggle answer visibility in study mode
        function toggleAnswer() {
            const questions = getCurrentQuestions();
            const currentQuestion = questions[currentQuestionIndex];
            
            showAnswer = !showAnswer;
            
            if (showAnswer) {
                // Show answers
                answerList.innerHTML = '';
                currentQuestion.answers.forEach(answer => {
                    const li = document.createElement('li');
                    li.className = 'answer-item';
                    li.innerHTML = `<span class="answer-bullet">•</span> ${answer}`;
                    answerList.appendChild(li);
                });
                
                answerContainer.classList.remove('hidden');
                showAnswerBtn.textContent = 'Hide Answer';
            } else {
                // Hide answers
                answerContainer.classList.add('hidden');
                showAnswerBtn.textContent = 'Show Answer';
            }
        }

        // Handle practice answer submission
        function handlePracticeAnswer() {
            currentAnswer = practiceInput.value.trim();
            if (!currentAnswer) return;
            
            const currentQuestion = practiceQuestions[currentQuestionIndex];
            const isCorrect = currentQuestion.answers.some(answer => 
                answer.toLowerCase().includes(currentAnswer.toLowerCase()) ||
                currentAnswer.toLowerCase().includes(answer.toLowerCase())
            );
            
            userAnswers.push({
                question: currentQuestion.question,
                userAnswer: currentAnswer,
                correctAnswers: currentQuestion.answers,
                isCorrect
            });
            
            // Move to next question or show results
            if (currentQuestionIndex + 1 >= practiceQuestions.length) {
                showResults();
            } else {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        // Navigate to previous question
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        // Navigate to next question
        function nextQuestion() {
            const questions = getCurrentQuestions();
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        // Reset questions to first question
        function resetQuestions() {
            currentQuestionIndex = 0;
            showAnswer = false;
            loadQuestion();
        }

        // Show results after practice mode
        function showResults() {
            const score = userAnswers.filter(a => a.isCorrect).length;
            const total = userAnswers.length;
            const percentage = Math.round((score / total) * 100);
            const isAsterisk = selectedCategory === 'asterisk';
            const passed = isAsterisk ? percentage >= 60 : percentage >= 60;
            
            // Update results display
            scoreDisplay.textContent = `${score}/${total}`;
            scoreDisplay.className = `score-display ${passed ? 'score-pass' : 'score-fail'}`;
            percentageDisplay.textContent = `${percentage}%`;
            percentageDisplay.className = `text-2xl mb-2 ${passed ? 'text-green-400' : 'text-red-400'}`;
            passFailDisplay.textContent = passed ? '✅ PASSED' : '❌ FAILED';
            passFailDisplay.className = `text-lg ${passed ? 'text-green-300' : 'text-red-300'}`;
            passingCriteria.textContent = isAsterisk ? 
                'Need 60% to pass (6/10)' : 'Need 60% to pass (12/20)';
            
            // Generate answers review
            answersList.innerHTML = '';
            userAnswers.forEach((answer, index) => {
                const answerItem = document.createElement('div');
                answerItem.className = `answer-review-item ${answer.isCorrect ? 'border-l-4 border-green-500' : 'border-l-4 border-red-500'}`;
                
                answerItem.innerHTML = `
                    <div class="answer-status ${answer.isCorrect ? 'status-correct' : 'status-incorrect'}">
                        <span>${answer.isCorrect ? '✓' : '✗'}</span>
                        <span>Question ${index + 1}</span>
                    </div>
                    <p><strong>Question:</strong> ${answer.question}</p>
                    <div class="answer-details">
                        <div class="user-answer">
                            <strong>Your answer:</strong> ${answer.userAnswer}
                        </div>
                        ${!answer.isCorrect ? `
                        <div class="correct-answer">
                            <strong>Correct answers:</strong> ${answer.correctAnswers.slice(0, 3).join(' • ')}
                            ${answer.correctAnswers.length > 3 ? ' • ...' : ''}
                        </div>
                        ` : ''}
                    </div>
                `;
                
                answersList.appendChild(answerItem);
            });
            
            showView('results');
        }

        // Navigate back to mode select
        function backToModeSelect() {
            showView('modeSelect');
        }

        // Reset to main menu
        function resetToMenu() {
            selectedCategory = null;
            selectedSubcategory = null;
            currentQuestionIndex = 0;
            showAnswer = false;
            studyMode = 'study';
            practiceQuestions = [];
            userAnswers = [];
            currentAnswer = '';
            practiceComplete = false;
            showView('menu');
        }

        // Show a specific view
        function showView(viewName) {
            // Hide all views
            menuView.classList.add('hidden');
            modeSelectView.classList.add('hidden');
            questionView.classList.add('hidden');
            resultsView.classList.add('hidden');
            
            // Show the selected view
            switch(viewName) {
                case 'menu':
                    menuView.classList.remove('hidden');
                    break;
                case 'modeSelect':
                    modeSelectView.classList.remove('hidden');
                    break;
                case 'question':
                    questionView.classList.remove('hidden');
                    break;
                case 'results':
                    resultsView.classList.remove('hidden');
                    break;
            }
            
            currentView = viewName;
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>